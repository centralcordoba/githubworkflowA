#!/bin/bash

# Verificar si el token de GitHub está presente
if [[ -z "$GH_TOKEN" ]]; then
  echo "ERROR: El token de GitHub no está establecido."
  exit 1
fi

# Lista de repositorios a verificar
REPOS=("centralcordoba/githubworkflowA" "centralcordoba/MarvelAngular")

# Crear un archivo CSV para almacenar los datos de vulnerabilidades
echo "Repository,Vulnerability Count" > vulnerabilities.csv

# Loop a través de cada repositorio para verificar vulnerabilidades
for REPO in "${REPOS[@]}"; do
  # Obtener vulnerabilidades usando la API de GitHub y procesar los datos
  # Nota: Este es un ejemplo y puede necesitar ajustes según tus necesidades y la estructura de los datos de la API
  VULN_COUNT=$(curl -s -H "Authorization: token $GH_TOKEN" \
                   -H "Accept: application/vnd.github.v3+json" \
                   "https://api.github.com/repos/$REPO/vulnerability-alerts" | jq '. | length')
  
  # Añadir los datos al archivo CSV
  echo "$REPO,$VULN_COUNT" >> vulnerabilities.csv
done
