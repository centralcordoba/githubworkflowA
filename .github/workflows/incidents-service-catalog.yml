name: Update swagger.yaml repository githubworkflowB

on:
  push:
    paths:
      - 'swagger.yaml'

permissions:
  contents: write
  pull-requests: write

env:
  REPO_NAME: githubworkflowB
  REPO_PATH: temp-repo
  BRANCH_NAME: update-swagger-$(date +'%s')

jobs:
  checkout-and-update:
    name: Checkout and Update swagger.yaml
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Clone githubworkflowB repository
        uses: actions/checkout@v3
        with:
          repository: centralcordoba/${{ env.REPO_NAME }}
          token: ${{ secrets.SECRET_WORK_FLOW }}
          path: ${{ env.REPO_PATH }}

      - name: Create a new branch
        run: |
          cd ${{ env.REPO_PATH }}
          git checkout -b ${{ env.BRANCH_NAME }}

      - name: Copy swagger.yaml to the new branch in repository githubworkflowB
        run: cp ../../swagger.yaml ${{ env.REPO_PATH }}/swagger.yaml

      - name: Commit changes
        run: |
          cd ${{ env.REPO_PATH }}
          git add swagger.yaml
          git commit -m "Update swagger.yaml"
          git push origin ${{ env.BRANCH_NAME }}

      - name: Create PR
        run: |
          gh pr create --repo centralcordoba/${{ env.REPO_NAME }} \
            --base main \
            --head ${{ env.BRANCH_NAME }} \
            --title "Update swagger.yaml" \
            --body "Updated file swagger.yaml from incidents repository." \
            --reviewer centralcordoba
        env:
          GITHUB_TOKEN: ${{ secrets.SECRET_WORK_FLOW }}
